<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

<script src="scripts/utility.js"></script>
<script src="scripts/keyboard.js"></script>
<script src="scripts/canvas.js"></script>
<script src="scripts/animate.js"></script>
<script src="scripts/spritesheet.js"></script>
<script src="scripts/sprite.js"></script>
<script src="scripts/positions.js"></script>
<script src="scripts/world.js"></script>
<script src="scripts/collision.js"></script>
<script src="scripts/enemy.js"></script>

<script>
    let collisionDone = false;
    var Context = null;
    var contextWidth = 640;
    var contextHeight = 480;
    var bangSpriteSheet = new SpriteSheet("./bang.png", 20, 20, 8);
    var catSpriteSheet = new SpriteSheet("./cats.png", 20, 20, 4, HeroPositions);
    var dogSpriteSheet1 = new SpriteSheet("./dog-sprite-sheet.png", 20, 20, 5, EnemyPositions);
    var bang = new Sprite(bangSpriteSheet);
    var cat = new Sprite(catSpriteSheet);
    let cat_x = cat.x = 0;
    let cat_y = cat.y = 0;
    let enemiesArray = new Array();
    
    $(document).ready(function(){
        Context = new HTML("game", contextWidth, contextHeight);
        initKeyEvents();
        createEnemies(enemiesArray,10,200,200);
    });
    
    let drawCatHero = function(){
        let direction = DirectionEnum.none;
        if(keyState.keyLeftState){
            cat_x = cat_x-1;
            direction = DirectionEnum.left;
        }
        if(keyState.keyRightState){
            cat_x = cat_x+1;
            direction = DirectionEnum.right;
        }
        if(keyState.keyDownState){
            cat_y = cat_y+1;
            direction = DirectionEnum.down;
        }
        if(keyState.keyUpState){
            cat_y = cat_y-1;
            direction = DirectionEnum.up;
        }
        cat.draw(cat_x, cat_y, direction);
    }
    let collision = new Collision();
    setInterval(function(){
        drawMap();
        for (let i = 0; i < enemiesArray.length; i++) {
            if(!collisionDone){
                collisionDone = collision.detectCollision(cat, enemiesArray[i].sprite);
            }
            else {break;}
        }
            if(collisionDone)
            {
                bang.draw(cat_x, cat_y, [31,30,29,28,27,26,25,24,23,22,21,20,
                                        19,18,17,16,15,14,13,12,11,10,9,8,7,
                                        6,5,4,3,2,1,31,32]);
                                        // [31,30,29,28,27,26,25,24,23,22,21,20,
                                        // 19,18,17,16,15,14,13,12,11,10,9,8,7,
                                        // 6,5,4,3,2,1,31,32]
                collisionDone = true;
            } else {
                drawCatHero();
                for (let i = 0; i < enemiesArray.length; i++) {
                    enemiesArray[i].move();
                }
            }
    }, 40)

</script>
</head>
<body scroll="no" style="overflow: hidden">
    <canvas id="game"></canvas>
</body>
</html>


