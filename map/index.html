<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

<script src="scripts/utility.js"></script>
<script src="scripts/keyboard.js"></script>
<script src="scripts/canvas.js"></script>
<script src="scripts/animate.js"></script>
<script src="scripts/spritesheet.js"></script>
<script src="scripts/sprite.js"></script>
<script src="scripts/world.js"></script>
<script src="scripts/collision.js"></script>
<script src="scripts/enemy-utility.js"></script>

<script>
    let collisionDone = false;
    var Context = null;
    var contextWidth = 640;
    var contextHeight = 480;
    var BLOCK_W = 32;
    var BLOCK_H = 32;
    var wall = new Sprite("./wall.png");
    var waterSpriteSheet = new SpriteSheet("./water.png", 32, 32);
    var water = new Sprite(waterSpriteSheet);
    var bangSpriteSheet = new SpriteSheet("./bang.png", 20, 20, 8);
    var catSpriteSheet = new SpriteSheet("./cats.png", 20, 20, 4);
    var dogSpriteSheet = new SpriteSheet("./dog-sprite-sheet.png", 20, 20, 4);
    var bang = new Sprite(bangSpriteSheet);
    var cat = new Sprite(catSpriteSheet);
    let cat_x = cat.x = 0;
    let cat_y = cat.y = 0;
    var dog = new Sprite(dogSpriteSheet);
    let dog_x = dog.x = 32;
    let dog_y = dog.y = 32;
    let enemyUtility = new EnemyUtility();
    var map = [0,1,1,1,1,1,1,1,1,1,
               0,1,0,0,1,1,1,0,0,1,
               1,1,0,0,0,0,0,0,0,1,
               1,1,0,0,1,1,1,0,0,1,
               1,1,0,1,0,1,1,0,0,1,
               1,1,0,0,1,1,1,0,0,1,
               1,1,1,1,1,1,1,0,0,1,
               1,1,0,0,1,1,1,0,0,1,
               1,1,1,1,1,1,1,0,0,1,
               1,1,1,1,1,1,1,1,1,1];

    $(document).ready(function(){
        Context = new HTML("game", contextWidth, contextHeight);
        initKeyEvents();
    });
    let drawMap = function(){
        let mapIndex = 0;
        for (let y = 0; y < 10; y=y+1) {
            for (let x = 0; x < 10; x=x+1, mapIndex++) {
                let x_new = x * BLOCK_W;
                let y_new = y * BLOCK_H;
                if(map[mapIndex] == 1) {
                    wall.draw(x_new, y_new);
                }
                else {
                    water.draw(x_new, y_new);
                }
            } 
        }
    }
    let drawCatHero = function(){
        let spriteSheetIndex = [17,18,19,20,21,22,22,22,22,22,22,22,22,23];
        if(keyState.keyLeftState){
            cat_x = cat_x-1;
            spriteSheetIndex = [12,13,14,15];
        }
        if(keyState.keyRightState){
            cat_x = cat_x+1;
            spriteSheetIndex = [4,5,6,7];
        }
        if(keyState.keyDownState){
            cat_y = cat_y+1;
            spriteSheetIndex = [0,1,2,3];
        }
        if(keyState.keyUpState){
            cat_y = cat_y-1;
            spriteSheetIndex = [8,9,10,11];
        }
        cat.draw(cat_x, cat_y, spriteSheetIndex);
    }
    let collision = new Collision();
    setInterval(function(){
        drawMap();
        if(!collisionDone){
            collisionDone = collision.detectCollision(cat,dog);
        }
            if(collisionDone)
            {
                bang.draw(cat_x, cat_y, [31,30,29,28,27,26,25,24,23,22,21,20,
                                        19,18,17,16,15,14,13,12,11,10,9,8,7,
                                        6,5,4,3,2,1,31,32]);
                                        // [31,30,29,28,27,26,25,24,23,22,21,20,
                                        // 19,18,17,16,15,14,13,12,11,10,9,8,7,
                                        // 6,5,4,3,2,1,31,32]
                collisionDone = true;
            } else {
                drawCatHero();
                dog_xy = enemyUtility.getEnemyCoordinates(dog_x, dog_y, 1, 200, 200);
                dog_x = dog_xy.x;
                dog_y = dog_xy.y;
                dog.draw(dog_x, dog_y, [1,2,3]);
            }
    }, 40)

</script>
</head>
<body scroll="no" style="overflow: hidden">
    <canvas id="game"></canvas>
</body>
</html>


